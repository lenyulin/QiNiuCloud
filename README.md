# README.md

## 项目背景
本项目旨在开发一个根据文本或图片生成 3D 模型的网页，聚焦于单个素材元素的 3D 模型生成，无需涉及场景级别（例如仅生成一匹马，而非一匹马在草原奔跑的场景）。

## 需回答的问题
1. **用户类型、痛点与用户故事**

   你计划将这个网页面向什么类型的用户？这些类型的用户他们面临什么样的痛点，你设想的用户故事是什么样呢？ 

   1.1. ***用户类型***

   第一类是游戏设计师、产品设计师，快速为产品的原型模型进行设计。

   第二类是教育工作者，通过生成的3D模型，让学生更加直观理解物体结构。

   第三类是个人模型爱好者， 喜欢自己设计制作并打印3D模型手办，但缺乏专业建模技能的个人。

   1.2. ***用户痛点***

   第一类：使用专业建模软件建模复杂且耗时，不利于产品原型在项目初期快速迭代。

   第二类：制作用于教学演示的3D模型需要专业技能，费时费力，且制作的模型往往无法达到预期效果。

   第三类：有创意，但使用软件设计模型费时费力，且制作的模型往往无法达到预期效果。

   所有人：使用AI建模成本较高，在无法保证生成模型质量的情况下使用，会产生巨大的试错成本。

   1.3. ***用户故事***

   第一类：希望产品在项目初期时，我能够将多个创意快速转化为3D模型，并将这些模型用于进一步与团队进行沟通交流或评审，并能够根据反馈快速迭代3D模型。
我希望这段时间我的精力能够放在创意设计上，而不是花费在手动建模上。 

   第二类：在以往的教学生涯中，我只能通过图片以及文字描述向学生描述例如细胞结构、器官结构。这种方法往往依赖学生自生丰富的想象力，对于比较多的学生来说，
这种讲解往往来得空洞，不易理解。通过3D模型，我能够让学生更加快速且直观地理解这些内容，提升教学效率，并且无需耗费我大量的时间和精力来制作模型。

   第三类：作为模型爱好者，我喜欢搜藏各种我所喜欢的模型手办，因此我希望我能够通过文字描述我的创意内容，就能够生成精美的3D模型，这样就能够满足我搜藏的
爱好，而不是将时间花费在学习和使用专业的建模软件上面。

   所有人：我希望有一个聚合平台，能够生成和下载一些已经生成过的模型，我能够在付费之前就清楚看到模型的质量和效果。即便我需要付费生成还没有的模型，我也可以在不同供应商那里
获取一个质量相对较高的模型，以便降低我的试错成本，并提升选择到优质模型的机会。

2. **功能需求、优先级与本次开发计划**

   你认为这个网页需要哪些功能？这些功能各自的优先级是什么？你计划本次开发哪些功能？

   2.1. ***功能***

   核心功能： 

   1： 用户通过输入自己堆对模型的文字描述，即可生成模型，并且能够下载自己认为满意的模型。 优先级：高

   2： 用户能够在界面预览生成的模型，以及预览图。 优先级：高

   进阶功能：

   1： 输入描述，就能快速获取以往别人已经生成过的相似描述的模型，减少等待模型生成的时间，减少使用的成本。 优先级：高

   2： 能够一站式获取不同服务提供商所产生的模型。 优先级：高

3. **3D 模型生成 API 选择**

   你计划采纳哪家公司提供的 3D 模型生成 API？你对比了哪些公司的 API，你为什么选择用这家公司的 API？

   3.1. ***APIs***

   对比了腾讯混元3D、Meshy、3d.csm.ai供应商。

   3.1. ***选择***

   最终选择了腾讯混元3D

   3.2. ***原因***

   主要原因：门槛较低，腾讯为新开发者提供了一定数量的免费调用次数，降低了开发成本
   
   次要原因：腾讯提供了完善的SDK，并且拥有丰富的文档，以及网页调试工具，能够大幅度加速开发

   次要原因：腾讯作为行业头部企业，它在生成类大模型的研发上拥有天然的优势，包括巨大的财力人力支持，它们的模型所生成的质量有保障，能够降低企业的试错成本

   次要原因：腾讯云作为国内知名云服务提供商，它的API不论是在响应速度还是稳定性上，都比其他的企业更有优势。


4. **效果评估与迭代系统**

   AI 应用和传统应用不同，它需要持续进行效果迭代。你会设置什么样的关键指标来作为验证 3D 模型生成效果的评估？你会设计一个什么样的系统来进行评估和改善，
请描述评估系统的设计。

   4.1. ***评估***

   评估可以根据以下多个维度进行：

   1： 用户自己点击。用户预览生成的模型后，可以点击旁边的LIKE/FAVORITE/Share按钮，表明本次生成的模型用户比较满意，可以增加模型评分。

   2： 后台搜集信息。用户遇到自己需要的模型会点击下载按钮进行下载，此时表明我们生成的模型非常符合用户需求，因此该模型可以大大增加分数。

   3： 后台分析。用户点击下载按钮后，后台可以监控点击下载的时间，当用户再次点击另外的下载按钮后，后台更新时间，如果用户点击下载后很长一段时间
没有再次点击下载，这表明用户可能获取到了最为满意的模型，因此上次下载的模型分数可以大大增加。

   4： 前端发送行为数据信息。用户即便下载了模型，也可能是因为该模型基本满足用户需求，但并非最佳。此时用户会在网页进行停留，并浏览其他模型或是修改提示词
再次生成模型。因此前端可以定时汇报用户行为数据，这些数据将被后台储存和分析。当用户下载后立即关闭了连接，表明用户非常满意生成的模型，，因此该模型可以大
大增加分数。

   5： 问卷调查。让使用过的用户填写问卷调查表，并根据表中内容人工手动调整模型得分。

5. **减少第三方 API 调用频次**

   有什么方式可以让我们减少对第三方 3D 模型生成 API 的调用次数？请描述你认为各种可能的思路，并选择一种进行落地。

   5.1. ***思路***

   主要思路：通过对用户输入的描述文字进行分析，通过AI提取语句关键词，将关键词设置为KEY/TOKEN，与模型绑定。当用户输入描述文字后，通过关键词KEY直接查找是否
有已经生成的类似的模型，如有，直接返回结果，没有，则调用第三方API进行生成。


   5.2. ***实现***

   请求发送至后端，首先进行提取，然后到redis中查找key是否存在，如果存在，直接返回多个结果的URL。如果不存在，则进一步调用API，当生成完毕后，将模型
数据写入数据库，并异步将模型上传至对象储存服务器，返回结果。

6. **设计细节**

   6.1. ***服务端流程***

   <img src="./serviceSide.png" alt="服务端流程示例图" width="500" height="300">

   用户将模型获取请求发送至web层，该层过滤掉无效请求（例如输入不合法等）

   然后请求被转发至服务层，服务层将用户输入交给Shrink包，该包通过调用大模型api接口，精简用户输入，以生成能够作为缓存key的token

   生成的token用于查找相关的模型数据，这些操作在Repo层完成，首先查询缓存数据是否有该条记录，有的话直接返回，没有的话则进一步处理

   对于没有缓存的token，首先通过布隆过滤器，对于数据库中不存在的token，直接返回ErrRecordNotFound给上一层，有则查询数据库

   服务层接收到ErrRecordNotFound错误，则生成事务请求转发给异步模型生成事务管理器，然后直接返回事务id

   6.2. ***模型生成流程***

   异步模型生成事务管理器通过Chanel接收到请求后，将请求转发给封装了第三方生成模型管理器ProviderManager，该管理器将请求转发给封装了不同API服务的Provider
（这里暂时只完成了一种基于腾讯混元3D的API开发）

   为了减少阻塞，这里管理器发送调用请求后，便轮询这些Provider以查询生成结果

   Provider查询到自己的任务完成后，会告知ProviderManager事务已完成，并通知ModelGnerationResultHelper进行进一步处理

   6.3. ***处理生成结果***

   当ModelGnerationResultHelper收到完成通知后，便会根据服务提供商所提供的数据处理模型

   首先它会下载服务商提供的模型以及缩略图，当本地写入文件后， 表明文件已处理完毕，然后发送文件上传请求给MultiOssManager进行进一步处理

   6.4. ***对象上传***

   MultiOssManager是专门用于上传文件至对象储存服务器的工具

   MultiOssManager内部采用了OSS对象池，它会自动管理OSS对象，每次有上传任务时，管理器从池中选择一个可用对象进行处理（这些OSS的服务商、桶可能不一样）

   当上传完毕后，OSS对象被标记为空闲，等待下一次调用，MultiOssManager会将文件上传后返回的地址信息发送至redis，待进一步处理


   6.5. ***添加数据到数据库和缓存***

   ModelGnerationResultHelper会开启一个异步进程RunAsyncCheckUploadTx用于轮询管理OSS上传结果，并将结果保存至数据库，并进一步更新缓存
   
   ...Finished...
   